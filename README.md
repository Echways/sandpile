# Sandpile

Небольшое консольное приложение на C++ для моделирования «песчаной кучи» (Abelian sandpile).
Программа читает начальную конфигурацию песчинок из файла, выполняет «осыпания» до устойчивого состояния (или заданного числа шагов) и сохраняет результат в виде BMP-изображения.
Приложение выполнено без использования сторонних библиотек и контейнеров не из стандартной библиотеки.

## Поддерживаемые команды

`-i, --input` - tsv-файл (tab-separated values) c начальными данными

`-o, --output` - путь к директории для сохранения картинок

`-m, --max-iter` - максимальное количество итераций модели

`-f, --freq` - частота, с которой должны сохранятся картинки (если 0, то сохраняется только последнее состояние)

## Начальное состояние

Начальное состояние задается файлом со значением количества песчинок в каждой ячейке, кроме пустых. Размер сетки следует рассчитать на основании этих данных - минимальный прямоугольник в который попадают все ячейки.

Формат файла: Каждая строчка содержит информацию об одной ячейке, в виде `(x-координаты, y-координаты, количество песчинок)`, разделенных символом табуляции. Количество песчинок гарантированно влезет в `uint64_t`, координаты гарантированно влезают в `int16_t`

## Правила формирования изображения 

1. Размер картинки равен размеру поля.

2. Каждый пиксель соответствует ячейке поля.

2. Цвет пикселя зависит от количества песчинок в ячейке.

    + 0 - белый
    + 1 - зеленый
    + 2 - желтый
    + 3 - фиолетовый
    + \> 3 - черный

4. Кодирование 1 пикселя должно занимать не более 4 бит.

## Сборка

```bash
git clone git@github.com:Echways/sandpile.git
cd itmo-sandpile-task-main

mkdir build
cd build
cmake ..
cmake --build .
```

## Пример запуска

Ограничить 1000 итерациями и сохранять картинку каждые 50 шагов (файлы вида sandpile0.bmp, sandpile50.bmp, …) и финальную:

```bash
./Sandpile -i input.txt -o sandpile.bmp -m 1000 -f 50
```
